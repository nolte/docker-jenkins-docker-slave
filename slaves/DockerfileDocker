# Dockerfile
FROM java:7-jre

ENV JENKINS_SLAVE_NODE=node-js
ENV JENKINS_MASTER_HOST=jenkinshost
ENV JENKINS_MASTER_PORT=8080

RUN apt-get update && apt-get install git -y

RUN apt-get update &&  apt-get install apt-transport-https ca-certificates -y

RUN apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D

RUN echo "deb https://apt.dockerproject.org/repo debian-jessie main" > /etc/apt/sources.list.d/docker.list
RUN apt-get update
RUN apt-cache policy docker-engine

RUN  apt-get install docker-engine -y

WORKDIR /opt/jenkins-slave

ADD ./slave.jar /tmp/slave.jar
RUN chmod u+x /tmp/slave.jar
#RUN chown  -R 1000


RUN  mkdir /usr/local/share/ca-certificates/docker-dev-cert
COPY ./registry-cert/devdockerCA.crt /usr/local/share/ca-certificates/docker-dev-cert
COPY ./registry-cert/domain.crt /usr/local/share/ca-certificates/docker-dev-cert

RUN update-ca-certificates

ADD ./startSlave.sh /opt/jenkins-slave/startSlave.sh

ENTRYPOINT ["sh", "/opt/jenkins-slave/startSlave.sh"]
CMD [""]